<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><script src="/csc-data-blog/livereload.js?mindelay=10&amp;v=2&amp;port=4321&amp;path=csc-data-blog/livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content=" Definitions API\nAn application programming interface (API) is a formalized way of interacting with another piece of hardware or software without needing to know how that hardware or software actually works. As such, it is a convenient method of making requests to get, update, or push information between your system and the remote system. As a loose analogy, you can think of this as a menu in a resuraunt; you don&rsquo;t need to know how the kitchen makes your food, but you need to know what you can ask for from your server. When you want scrambled eggs, you don&rsquo;t need to go into the kitchen and make these from scratch, you simply put in a request based on the options on the menu.\n">
<title>Abacus API</title>

<link rel='canonical' href='http://localhost:4321/csc-data-blog/p/abacus-api/'>

<link rel="stylesheet" href="/csc-data-blog/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Abacus API">
<meta property='og:description' content=" Definitions API\nAn application programming interface (API) is a formalized way of interacting with another piece of hardware or software without needing to know how that hardware or software actually works. As such, it is a convenient method of making requests to get, update, or push information between your system and the remote system. As a loose analogy, you can think of this as a menu in a resuraunt; you don&rsquo;t need to know how the kitchen makes your food, but you need to know what you can ask for from your server. When you want scrambled eggs, you don&rsquo;t need to go into the kitchen and make these from scratch, you simply put in a request based on the options on the menu.\n">
<meta property='og:url' content='http://localhost:4321/csc-data-blog/p/abacus-api/'>
<meta property='og:site_name' content='R &amp; Python Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='R' /><meta property='article:tag' content='rstudio' /><meta property='article:published_time' content='2025-02-14T14:00:00-08:00'/><meta property='article:modified_time' content='2025-02-14T14:00:00-08:00'/>
<meta name="twitter:title" content="Abacus API">
<meta name="twitter:description" content=" Definitions API\nAn application programming interface (API) is a formalized way of interacting with another piece of hardware or software without needing to know how that hardware or software actually works. As such, it is a convenient method of making requests to get, update, or push information between your system and the remote system. As a loose analogy, you can think of this as a menu in a resuraunt; you don&rsquo;t need to know how the kitchen makes your food, but you need to know what you can ask for from your server. When you want scrambled eggs, you don&rsquo;t need to go into the kitchen and make these from scratch, you simply put in a request based on the options on the menu.\n">
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-PQ1KG9NWP0"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-PQ1KG9NWP0');
        }
      </script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/csc-data-blog/">
                
                    
                    
                    
                        
                        <img src="/csc-data-blog/img/avatar_hu_365c3288643681d2.png" width="300"
                            height="303" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/csc-data-blog">R &amp; Python Blog</a></h1>
            <h2 class="site-description">Brought to you by UBCO&#39;s Center for Scholarly Communication</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='csc.ok@ubc.ca'
                        target="_blank"
                        title="Email"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" encoding="UTF-8"?>
<svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 800 800">
  <!-- Generator: Adobe Illustrator 29.4.0, SVG Export Plug-In . SVG Version: 2.1.0 Build 152)  -->
  <defs>
    <style>
      .st0, .st1, .st2 {
        fill: none;
      }

      .st1 {
        stroke-linejoin: round;
      }

      .st1, .st2 {
        stroke: #000;
        stroke-linecap: round;
        stroke-width: 66.7px;
      }

      .st2 {
        stroke-miterlimit: 133.3;
      }
    </style>
  </defs>
  <path class="st1" d="M133.3,300l206.7,155c35.6,26.7,84.4,26.7,120,0l206.7-155"/>
  <path class="st2" d="M100,305.9c0-24.2,13.1-46.5,34.3-58.3l233.3-129.6c20.1-11.2,44.6-11.2,64.8,0l233.3,129.6c21.2,11.8,34.3,34.1,34.3,58.3v260.8c0,36.8-29.8,66.7-66.7,66.7H166.7c-36.8,0-66.7-29.8-66.7-66.7v-260.8Z"/>
  <path class="st0" d="M0,0h800v800H0V0Z"/>
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/csc-ubc-okanagan'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/csc-data-blog/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/csc-data-blog/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/csc-data-blog/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/csc-data-blog/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/csc-data-blog/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#definitions">Definitions</a></li>
    <li><a href="#set-up">Set up</a></li>
    <li><a href="#steps">Steps</a></li>
    <li><a href="#caveats">Caveats</a></li>
    <li><a href="#building-the-connection">Building the Connection</a></li>
    <li><a href="#search-api">Search API</a></li>
    <li><a href="#implementing-the-search-in-r">Implementing the Search in <code>R</code></a></li>
    <li><a href="#data-wrangling">Data Wrangling</a></li>
    <li><a href="#getting-all-the-data">Getting All the Data</a></li>
    <li><a href="#explore">Explore</a></li>
    <li><a href="#looking-at-files">Looking at Files</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/csc-data-blog/categories/r/" >
                R
            </a>
        
            <a href="/csc-data-blog/categories/api/" >
                API
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/csc-data-blog/p/abacus-api/">Abacus API</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Feb 14, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    19 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    
		  Mathew Vis-Dunbar &amp; Nick Rochlin
	  
    <script src="/csc-data-blog/p/abacus-api/index.en_files/kePrint/kePrint.js"></script>
<link href="/csc-data-blog/p/abacus-api/index.en_files/lightable/lightable.css" rel="stylesheet" />
<script src="/csc-data-blog/p/abacus-api/index.en_files/kePrint/kePrint.js"></script>
<link href="/csc-data-blog/p/abacus-api/index.en_files/lightable/lightable.css" rel="stylesheet" />
<script src="/csc-data-blog/p/abacus-api/index.en_files/kePrint/kePrint.js"></script>
<link href="/csc-data-blog/p/abacus-api/index.en_files/lightable/lightable.css" rel="stylesheet" />
<script src="/csc-data-blog/p/abacus-api/index.en_files/kePrint/kePrint.js"></script>
<link href="/csc-data-blog/p/abacus-api/index.en_files/lightable/lightable.css" rel="stylesheet" />
<script src="/csc-data-blog/p/abacus-api/index.en_files/kePrint/kePrint.js"></script>
<link href="/csc-data-blog/p/abacus-api/index.en_files/lightable/lightable.css" rel="stylesheet" />
<h2 id="definitions">Definitions
</h2><p><strong>API</strong></p>
<p>An application programming interface (API) is a formalized way of interacting with another piece of hardware or software without needing to know how that hardware or software actually works. As such, it is a convenient method of making requests to get, update, or push information between your system and the remote system. As a loose analogy, you can think of this as a menu in a resuraunt; you don&rsquo;t need to know how the kitchen makes your food, but you need to know what you can ask for from your server. When you want scrambled eggs, you don&rsquo;t need to go into the kitchen and make these from scratch, you simply put in a request based on the options on the menu.</p>
<p><strong>JSON</strong></p>
<p>JavaScript Object Notation (JSON) is a method for storing and transmitting data primarily using key value pairs. It is compact, flexible, human readable, and works well in a Web based environment. It is generally the default format in which data is transmitted from an API.</p>
<h2 id="set-up">Set up
</h2><p>The Abacus API is accessible through http, which means we can access the API using any http compliant tool, including a web browser.</p>
<p>By default, the API returns data in JSON notation. One of the issues we have when working in <code>R</code> is that <code>R</code> excels with rectangular data, especially if working in the <code>Tidyverse</code>. So we need to wrangle the JSON formatted  data into a data structure more amenable to R. This begins by moving content into a list after which we can transition it to a dataframe, or tibble, as needed.</p>
<p>To do this all, we&rsquo;ll use the following four libraries, although, as we&rsquo;ll see later, we can get away with just the <code>httr2</code> package:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">httr2</span><span class="p">)</span> <span class="c1"># http protocols</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">jsonlite</span><span class="p">)</span> <span class="c1"># json to r data structures</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="steps">Steps
</h2><p>In the proceding sections we&rsquo;ll cover the following steps:</p>
<ol>
<li>Using the <code>search</code> API to look for relevant datasets.</li>
<li>Plugging a unique ID associated with the dataset(s) of interest into the <code>datasets</code> api to identify the files of interest. This involves first identifying a new unique ID for each dataset, only accessible through the <code>datasets</code> API, and the version of the dataset we&rsquo;re interested in (an Abacus record is version controlled).</li>
<li>We will then use the urls associated with the data files to download the relevant data.</li>
</ol>
<p>We will be working with the Statistics Canada Labour Force Surveys for this exercise.</p>
<h2 id="caveats">Caveats
</h2><p>This is a simplified overview of API interactions. So, for example, we will not be doing any error handling, nor will we deal with using authentication tokens. But these are easily built in once the general approach is understood, and the <code>httr2</code> package has functions for handling these things.</p>
<h2 id="building-the-connection">Building the Connection
</h2><p>Abacus is built on a Dataverse instance. You can <a class="link" href="https://guides.dataverse.org/en/latest/api/index.html"  target="_blank" rel="noopener"
    >refer to the Dataverse API documentation</a> for more information on interacting with the API.</p>
<p>Abacus has more than one API. This is common when interacting with APIs. Each API gives you access to certain functionalities and returns certain pieces of data. Here, we&rsquo;ll review the <code>search</code> and <code>datasets</code> APIs; the former to locate content, the latter to retrieve that content. We will ultimately use the <code>access</code> API with <code>download.file()</code> to acquire the data.</p>
<p>In either case, we start with the base url into the API, which we&rsquo;ll store in a variable.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">base_url</span> <span class="o">&lt;-</span> <span class="s">&#34;https://abacus.library.ubc.ca/api/&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Next, we can add on the specific API we intend to search.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">search_api</span> <span class="o">&lt;-</span> <span class="s">&#34;search?q=&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>search</code> API requires a <code>query</code> parameter, ie, something to search for. This is articulated as a string, following the <code>?q=</code>.</p>
<p>Note: When using the <code>httr2</code> package, if the query string is multi-word, spaces need to be filled with <code>%20</code>. For example, a search for <code>labour force</code> will fail, and need to be replaced with <code>labour%20force</code>.</p>
<h2 id="search-api">Search API
</h2><p>There are a variety of fields and file types that we can search through the search API, noting that, as a data repository, objects in Abacus are organized into dataverses, datasets, and files, where datasets reside in dataverses, and files within datasets. Datasets provide a high level overview of the data they hold, including descriptions, number of files, who produced the files, when they were uploaded, etc.</p>
<p>We&rsquo;ve already built our <code>base_url</code> and added on the requisite text to access the <code>search</code> API, <code>search_api</code>. We&rsquo;ll now build our query, specifying the query and the file type of interest, ie, do we want to search for a dataverse, dataset, or file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">search_query</span> <span class="o">&lt;-</span> <span class="s">&#34;title:labour&#34;</span> <span class="c1"># retrieve everything with the word labour in the title</span>
</span></span><span class="line"><span class="cl"><span class="n">search_type</span> <span class="o">&lt;-</span> <span class="s">&#34;&amp;type=dataset&#34;</span> <span class="c1"># limit to datasets</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can then paste these together to construct a full query.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="p">(</span><span class="n">search_api_call</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">search_api</span><span class="p">,</span> <span class="n">search_query</span><span class="p">,</span> <span class="n">search_type</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] &#34;https://abacus.library.ubc.ca/api/search?q=title:labour&amp;type=dataset&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>To get a sense of what this looks like, we can load this query in our browser.</p>
<h2 id="implementing-the-search-in-r">Implementing the Search in <code>R</code>
</h2><p>The <code>hhtr2</code> package will allow us to make http requests from within <code>R</code>. The steps involved including:</p>
<p>a) building a request; and then
b) performing that request, which results in some data being sent back to us.</p>
<p>These two steps are done, respectively, with the <code>request()</code> and <code>req_perform()</code> functions. We feed our <code>search_api_call</code> into the <code>request()</code> and then feed the result into the <code>req_preform</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">search_resp</span> <span class="o">&lt;-</span> <span class="n">search_api_call</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">httr2</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">httr2</span><span class="o">::</span><span class="nf">req_perform</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>What we get back is the same as what we saw in our browser, formatted as a list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">str</span><span class="p">(</span><span class="n">search_resp</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## List of 7
</span></span><span class="line"><span class="cl">##  $ method     : chr &#34;GET&#34;
</span></span><span class="line"><span class="cl">##  $ url        : chr &#34;https://abacus.library.ubc.ca/api/search?q=title:labour&amp;type=dataset&#34;
</span></span><span class="line"><span class="cl">##  $ status_code: int 200
</span></span><span class="line"><span class="cl">##  $ headers    :List of 8
</span></span><span class="line"><span class="cl">##   ..$ Date                        : chr &#34;Tue, 08 Apr 2025 17:05:46 GMT&#34;
</span></span><span class="line"><span class="cl">##   ..$ Server                      : chr &#34;Apache/2.4.37 (Red Hat Enterprise Linux) OpenSSL/1.1.1k mod_R/1.2.9 R/3.5.0 mod_apreq2-20101207/2.8.1&#34;
</span></span><span class="line"><span class="cl">##   ..$ X-Frame-Options             : chr &#34;SAMEORIGIN&#34;
</span></span><span class="line"><span class="cl">##   ..$ Access-Control-Allow-Origin : chr &#34;*&#34;
</span></span><span class="line"><span class="cl">##   ..$ Access-Control-Allow-Methods: chr &#34;PUT, GET, POST, DELETE, OPTIONS&#34;
</span></span><span class="line"><span class="cl">##   ..$ Access-Control-Allow-Headers: chr &#34;Accept, Content-Type, X-Dataverse-Key&#34;
</span></span><span class="line"><span class="cl">##   ..$ Content-Type                : chr &#34;application/json;charset=UTF-8&#34;
</span></span><span class="line"><span class="cl">##   ..$ Transfer-Encoding           : chr &#34;chunked&#34;
</span></span><span class="line"><span class="cl">##   ..- attr(*, &#34;class&#34;)= chr &#34;httr2_headers&#34;
</span></span><span class="line"><span class="cl">##  $ body       : raw [1:24063] 7b 22 73 74 ...
</span></span><span class="line"><span class="cl">##  $ request    :List of 7
</span></span><span class="line"><span class="cl">##   ..$ url     : chr &#34;https://abacus.library.ubc.ca/api/search?q=title:labour&amp;type=dataset&#34;
</span></span><span class="line"><span class="cl">##   ..$ method  : NULL
</span></span><span class="line"><span class="cl">##   ..$ headers : list()
</span></span><span class="line"><span class="cl">##   ..$ body    : NULL
</span></span><span class="line"><span class="cl">##   ..$ fields  : list()
</span></span><span class="line"><span class="cl">##   ..$ options : list()
</span></span><span class="line"><span class="cl">##   ..$ policies: list()
</span></span><span class="line"><span class="cl">##   ..- attr(*, &#34;class&#34;)= chr &#34;httr2_request&#34;
</span></span><span class="line"><span class="cl">##  $ cache      :&lt;environment: 0x136290320&gt; 
</span></span><span class="line"><span class="cl">##  - attr(*, &#34;class&#34;)= chr &#34;httr2_response&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>What we&rsquo;re most interested in here is the <code>body</code>. However, the <code>body</code> is sent to us structured as json and in raw bytes. This is generally the case with an API response. <code>httr2</code> has a built in function for converting the body from raw to something <code>R</code> can work with &ndash; <code>resp_body_json()</code> &ndash; and we&rsquo;ll use this later, but we&rsquo;ll start with the <code>jsonlite</code> package to explore this process step by step.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">search_resp</span><span class="o">$</span><span class="n">body</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Length  Class   Mode 
</span></span><span class="line"><span class="cl">##  24063    raw    raw
</span></span></code></pre></td></tr></table>
</div>
</div><p>Since we only want the <code>body</code> going forward, we&rsquo;ll isolate this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">search_body</span> <span class="o">&lt;-</span> <span class="n">search_resp</span><span class="o">$</span><span class="n">body</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="data-wrangling">Data Wrangling
</h2><p>Our first task is to convert this raw data to character data. We can do this with <code>rawToChar</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">search_body_char</span> <span class="o">&lt;-</span> <span class="nf">rawToChar</span><span class="p">(</span><span class="n">search_body</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We&rsquo;re presented with a vector of length one, which if we print out the first bit of, does not look very friendly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">search_body_char</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##    Length     Class      Mode 
</span></span><span class="line"><span class="cl">##         1 character character
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">str</span><span class="p">(</span><span class="n">search_body_char</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##  chr &#34;{\&#34;status\&#34;:\&#34;OK\&#34;,\&#34;data\&#34;:{\&#34;q\&#34;:\&#34;title:labour\&#34;,\&#34;total_count\&#34;:111,\&#34;start\&#34;:0,\&#34;spelling_alternatives\&#34;:{&#34;| __truncated__
</span></span></code></pre></td></tr></table>
</div>
</div><p>This looks a little friendlier with <code>cat()</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># not executed</span>
</span></span><span class="line"><span class="cl"><span class="nf">cat</span><span class="p">(</span><span class="n">search_body_char</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Our next task then, is to convert this JSON notation to a suitable <code>R</code> data structure, in this case, a list. We&rsquo;ll do this with the <code>jsonlite</code> package.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">search_body_list</span> <span class="o">&lt;-</span> <span class="n">jsonlite</span><span class="o">::</span><span class="nf">fromJSON</span><span class="p">(</span><span class="n">search_body_char</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If we look at how this has been converted, we can see it&rsquo;s a list of two.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">search_body_list</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##        Length Class  Mode     
</span></span><span class="line"><span class="cl">## status 1      -none- character
</span></span><span class="line"><span class="cl">## data   6      -none- list
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>data</code> list is what we want. We&rsquo;ll pull that out and then explore that list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">search_data</span> <span class="o">&lt;-</span> <span class="n">search_body_list</span><span class="o">$</span><span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">search_data</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Length </th>
   <th style="text-align:left;"> Class </th>
   <th style="text-align:left;"> Mode </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> q </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> -none- </td>
   <td style="text-align:left;"> character </td>
  </tr>
  <tr>
   <td style="text-align:left;"> total_count </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> -none- </td>
   <td style="text-align:left;"> numeric </td>
  </tr>
  <tr>
   <td style="text-align:left;"> start </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> -none- </td>
   <td style="text-align:left;"> numeric </td>
  </tr>
  <tr>
   <td style="text-align:left;"> spelling_alternatives </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> -none- </td>
   <td style="text-align:left;"> list </td>
  </tr>
  <tr>
   <td style="text-align:left;"> items </td>
   <td style="text-align:left;"> 27 </td>
   <td style="text-align:left;"> data.frame </td>
   <td style="text-align:left;"> list </td>
  </tr>
  <tr>
   <td style="text-align:left;"> count_in_response </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> -none- </td>
   <td style="text-align:left;"> numeric </td>
  </tr>
</tbody>
</table>
<p>We&rsquo;re slowly whittling this down. This now looks almost identical to what we pulled up in our browser earlier. The actual relevant content is in the <code>items</code> list. But we&rsquo;ll also need the <code>total_count</code> for when we need to request all the data from the server in a loop. For now, let&rsquo;s look at the 26 items in there.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">names</span><span class="p">(</span><span class="n">search_data</span><span class="o">$</span><span class="n">items</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##  [1] &#34;name&#34;                    &#34;type&#34;                   
</span></span><span class="line"><span class="cl">##  [3] &#34;url&#34;                     &#34;global_id&#34;              
</span></span><span class="line"><span class="cl">##  [5] &#34;description&#34;             &#34;published_at&#34;           
</span></span><span class="line"><span class="cl">##  [7] &#34;publisher&#34;               &#34;citationHtml&#34;           
</span></span><span class="line"><span class="cl">##  [9] &#34;identifier_of_dataverse&#34; &#34;name_of_dataverse&#34;      
</span></span><span class="line"><span class="cl">## [11] &#34;citation&#34;                &#34;storageIdentifier&#34;      
</span></span><span class="line"><span class="cl">## [13] &#34;keywords&#34;                &#34;subjects&#34;               
</span></span><span class="line"><span class="cl">## [15] &#34;fileCount&#34;               &#34;versionId&#34;              
</span></span><span class="line"><span class="cl">## [17] &#34;versionState&#34;            &#34;majorVersion&#34;           
</span></span><span class="line"><span class="cl">## [19] &#34;minorVersion&#34;            &#34;createdAt&#34;              
</span></span><span class="line"><span class="cl">## [21] &#34;updatedAt&#34;               &#34;contacts&#34;               
</span></span><span class="line"><span class="cl">## [23] &#34;publications&#34;            &#34;producers&#34;              
</span></span><span class="line"><span class="cl">## [25] &#34;geographicCoverage&#34;      &#34;authors&#34;                
</span></span><span class="line"><span class="cl">## [27] &#34;relatedMaterial&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>We don&rsquo;t need all this data. We should be able to do some evaluation with the <code>name</code>, <code>description</code>, <code>fileCount</code>, <code>producers</code>, <code>published_at</code>, <code>url</code>, and, for later retrieval, <code>global_id</code>. Let&rsquo;s look at these quickly, noting importantly, that <code>producers</code> is another list, that we&rsquo;ll need to wrangle some how.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">vars_of_interest</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">,</span> <span class="s">&#34;description&#34;</span><span class="p">,</span> <span class="s">&#34;fileCount&#34;</span><span class="p">,</span> <span class="s">&#34;producers&#34;</span><span class="p">,</span> <span class="s">&#34;published_at&#34;</span><span class="p">,</span> <span class="s">&#34;url&#34;</span><span class="p">,</span> <span class="s">&#34;global_id&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">lapply</span><span class="p">(</span><span class="n">search_data</span><span class="o">$</span><span class="n">items[vars_of_interest]</span><span class="p">,</span> <span class="n">class</span><span class="p">)</span> <span class="c1"># show the class of each list item</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## $name
</span></span><span class="line"><span class="cl">## [1] &#34;character&#34;
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## $description
</span></span><span class="line"><span class="cl">## [1] &#34;character&#34;
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## $fileCount
</span></span><span class="line"><span class="cl">## [1] &#34;integer&#34;
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## $producers
</span></span><span class="line"><span class="cl">## [1] &#34;list&#34;
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## $published_at
</span></span><span class="line"><span class="cl">## [1] &#34;character&#34;
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## $url
</span></span><span class="line"><span class="cl">## [1] &#34;character&#34;
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## $global_id
</span></span><span class="line"><span class="cl">## [1] &#34;character&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="getting-all-the-data">Getting All the Data
</h2><p>At this stage, we have what we need to pull search results from Abacus. You&rsquo;ll note that the search returned a result set of 109, but only 10 items:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="p">(</span><span class="n">search_body_list</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">total_count</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 111
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">search_body_list</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">items</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 10
</span></span></code></pre></td></tr></table>
</div>
</div><p>Going forward, we need to paginate through the result set to retrieve all the items.</p>
<p>A few things to note:</p>
<ul>
<li>By default, the <code>search</code> API returns 10 results per request. It allows for a maximum of 1000 per request. This is handled in the <code>per_page</code> parameter.</li>
<li>There is a start parameter that we can feed into the request; this indicates which record to start retrieving data from. This number will need to be updated as we iterate over our requests, for example, if in the first call we pull records 1:1000, in the second call, we need to start at 1001. This is handled in the <code>start</code> parameter.</li>
<li><code>R</code> starts counting at 1, other languages start at 0, so the first record returned by the API is indexed at 0 on the server, not 1.</li>
<li>APIs will have a limit on the number of requests you can make in any given time span. We&rsquo;ll build in a simple delay using <code>Sys.Sleep()</code>, but <code>httr2</code> has a built in function for handling this as well.</li>
</ul>
<p>Below is a function with the above steps built into it. It takes two arguments, a search string and the number of results to retrieve per request. It also prints some progress information to the console.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">search_datasets</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">per_page</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Build the query</span>
</span></span><span class="line"><span class="cl">  <span class="n">url</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;https://abacus.library.ubc.ca/api/search?q=&#34;</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="s">&#34;&amp;type=dataset&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># Initial call to figure out total records</span>
</span></span><span class="line"><span class="cl">  <span class="n">resp</span> <span class="o">&lt;-</span> <span class="n">url</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">httr2</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">httr2</span><span class="o">::</span><span class="nf">req_perform</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">resp_body</span> <span class="o">&lt;-</span> <span class="n">jsonlite</span><span class="o">::</span><span class="nf">fromJSON</span><span class="p">(</span><span class="nf">rawToChar</span><span class="p">(</span><span class="n">resp</span><span class="o">$</span><span class="n">body</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="n">total_count</span> <span class="o">&lt;-</span> <span class="n">resp_body</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">total_count</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># Give some feedback</span>
</span></span><span class="line"><span class="cl">  <span class="nf">cat</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;There are &#34;</span><span class="p">,</span> <span class="n">total_count</span><span class="p">,</span> <span class="s">&#34; records to be fetched.\n&#34;</span><span class="p">,</span> <span class="s">&#34;Fetching &#34;</span><span class="p">,</span> <span class="n">per_page</span><span class="p">,</span> <span class="s">&#34; records per call.\nThis will require &#34;</span><span class="p">,</span> <span class="nf">ceiling</span><span class="p">(</span><span class="n">total_count</span><span class="o">/</span><span class="n">per_page</span><span class="p">),</span> <span class="s">&#34; calls.\n\n&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># build place holders for loop</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">file_count</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">producers</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">pub_date</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">global_id</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">handle</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># establish the starting point</span>
</span></span><span class="line"><span class="cl">  <span class="n">start_point</span> <span class="o">&lt;-</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># create a counter for tracking calls</span>
</span></span><span class="line"><span class="cl">  <span class="n">call_counter</span> <span class="o">&lt;-</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># run the loop</span>
</span></span><span class="line"><span class="cl">  <span class="kr">while</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">total_count</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># while the number of retrieved records is &lt; the total count</span>
</span></span><span class="line"><span class="cl">    <span class="nf">cat</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;Call &#34;</span><span class="p">,</span> <span class="n">call_counter</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">))</span> <span class="c1"># Indicate what call we&#39;re on to the API</span>
</span></span><span class="line"><span class="cl">    <span class="n">req</span> <span class="o">&lt;-</span> <span class="n">httr2</span><span class="o">::</span><span class="nf">request</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s">&#34;&amp;start=&#34;</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="s">&#34;&amp;per_page=&#34;</span><span class="p">,</span> <span class="n">per_page</span><span class="p">))</span> <span class="c1"># create the request</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span> <span class="o">&lt;-</span> <span class="n">httr2</span><span class="o">::</span><span class="nf">req_perform</span><span class="p">(</span><span class="n">req</span><span class="p">)</span> <span class="c1"># perform the request</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp_body</span> <span class="o">&lt;-</span> <span class="n">jsonlite</span><span class="o">::</span><span class="nf">fromJSON</span><span class="p">(</span><span class="nf">rawToChar</span><span class="p">(</span><span class="n">resp</span><span class="o">$</span><span class="n">body</span><span class="p">))</span> <span class="c1"># convert the body from raw JSON to a list</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp_body_name</span> <span class="o">&lt;-</span> <span class="n">resp_body</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">items</span><span class="o">$</span><span class="n">name</span> <span class="c1"># get the name</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp_body_desc</span> <span class="o">&lt;-</span> <span class="n">resp_body</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">items</span><span class="o">$</span><span class="n">description</span> <span class="c1"># get the description</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp_body_file_count</span> <span class="o">&lt;-</span> <span class="n">resp_body</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">items</span><span class="o">$</span><span class="n">fileCount</span> <span class="c1"># get the file count</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp_body_producers</span> <span class="o">&lt;-</span> <span class="n">resp_body</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">items</span><span class="o">$</span><span class="n">producers</span> <span class="c1"># get the producers</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp_body_handle</span> <span class="o">&lt;-</span> <span class="n">resp_body</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">items</span><span class="o">$</span><span class="n">url</span> <span class="c1">#get the url</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp_body_global_id</span> <span class="o">&lt;-</span> <span class="n">resp_body</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">items</span><span class="o">$</span><span class="n">global_id</span> <span class="c1"># get id</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp_body_pubdate</span> <span class="o">&lt;-</span> <span class="n">resp_body</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">items</span><span class="o">$</span><span class="n">published_at</span> <span class="c1"># get update date</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># update the place holders:</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">resp_body_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">description</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">resp_body_desc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_count</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">file_count</span><span class="p">,</span> <span class="n">resp_body_file_count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">producers</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">producers</span><span class="p">,</span> <span class="n">resp_body_producers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">pub_date</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">pub_date</span><span class="p">,</span> <span class="n">resp_body_pubdate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">handle</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">resp_body_handle</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">global_id</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">global_id</span><span class="p">,</span> <span class="n">resp_body_global_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># update counters</span>
</span></span><span class="line"><span class="cl">    <span class="n">start_point</span> <span class="o">&lt;-</span> <span class="n">start_point</span> <span class="o">+</span> <span class="n">per_page</span> <span class="c1"># increment the start_point</span>
</span></span><span class="line"><span class="cl">    <span class="n">call_counter</span> <span class="o">&lt;-</span> <span class="n">call_counter</span> <span class="o">+</span> <span class="m">1</span> <span class="c1"># increment the counter</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Sys.sleep</span><span class="p">(</span><span class="m">.1</span><span class="p">)</span> <span class="c1"># pause before making a new call</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># When all is said and done, compile the place holders into a list and return this object</span>
</span></span><span class="line"><span class="cl">    <span class="kr">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="s">&#34;name&#34;</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;description&#34;</span> <span class="o">=</span> <span class="n">description</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;file_count&#34;</span> <span class="o">=</span> <span class="n">file_count</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;producers&#34;</span> <span class="o">=</span> <span class="n">producers</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;pub_date&#34;</span> <span class="o">=</span> <span class="n">pub_date</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;handle&#34;</span> <span class="o">=</span> <span class="n">handle</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;global_id&#34;</span> <span class="o">=</span> <span class="n">global_id</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can then call that function, here adding an additional parameter indicating that we only want to search the title and that we want 50 results per query. We&rsquo;re being specifically broad with our search.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">labour</span> <span class="o">&lt;-</span> <span class="nf">search_datasets</span><span class="p">(</span><span class="s">&#34;title:labour&#34;</span><span class="p">,</span> <span class="m">50</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## There are 111 records to be fetched.
</span></span><span class="line"><span class="cl">## Fetching 50 records per call.
</span></span><span class="line"><span class="cl">## This will require 3 calls.
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Call 1
</span></span><span class="line"><span class="cl">## Call 2
</span></span><span class="line"><span class="cl">## Call 3
</span></span></code></pre></td></tr></table>
</div>
</div><p>We now have record data that we can explore.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">labour</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Length </th>
   <th style="text-align:left;"> Class </th>
   <th style="text-align:left;"> Mode </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> name </td>
   <td style="text-align:left;"> 111 </td>
   <td style="text-align:left;"> -none- </td>
   <td style="text-align:left;"> character </td>
  </tr>
  <tr>
   <td style="text-align:left;"> description </td>
   <td style="text-align:left;"> 111 </td>
   <td style="text-align:left;"> -none- </td>
   <td style="text-align:left;"> character </td>
  </tr>
  <tr>
   <td style="text-align:left;"> file_count </td>
   <td style="text-align:left;"> 111 </td>
   <td style="text-align:left;"> -none- </td>
   <td style="text-align:left;"> numeric </td>
  </tr>
  <tr>
   <td style="text-align:left;"> producers </td>
   <td style="text-align:left;"> 111 </td>
   <td style="text-align:left;"> -none- </td>
   <td style="text-align:left;"> list </td>
  </tr>
  <tr>
   <td style="text-align:left;"> pub_date </td>
   <td style="text-align:left;"> 111 </td>
   <td style="text-align:left;"> -none- </td>
   <td style="text-align:left;"> character </td>
  </tr>
  <tr>
   <td style="text-align:left;"> handle </td>
   <td style="text-align:left;"> 111 </td>
   <td style="text-align:left;"> -none- </td>
   <td style="text-align:left;"> character </td>
  </tr>
  <tr>
   <td style="text-align:left;"> global_id </td>
   <td style="text-align:left;"> 111 </td>
   <td style="text-align:left;"> -none- </td>
   <td style="text-align:left;"> character </td>
  </tr>
</tbody>
</table>
<p>We can make this a bit easier for ourselves by converting this into a dataframe or tibble. There are several ways to approach this, considering that <code>producers</code> is a list &ndash; it is a list as some records have more than one producer associated them. Here, I&rsquo;ll treat datasets with multiple producers as a different record authority than if one of these co-producers produced a standalone dataset. To do this, we&rsquo;ll first collapse the <code>producers</code> nested lists, and then flatten the result into a single list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">labour</span><span class="o">$</span><span class="n">producers</span> <span class="o">&lt;-</span> <span class="n">labour</span><span class="o">$</span><span class="n">producers</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">lapply</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">paste</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">collapse</span> <span class="o">=</span> <span class="s">&#34;, &#34;</span><span class="p">))</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">unlist</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">labour</span><span class="o">$</span><span class="n">producers</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="m">20</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##  [1] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">##  [2] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">##  [3] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">##  [4] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">##  [5] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">##  [6] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">##  [7] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">##  [8] &#34;Statistics Canada. Labour Force Survey Division&#34;
</span></span><span class="line"><span class="cl">##  [9] &#34;Statistics Canada. Labour Force Survey Division&#34;
</span></span><span class="line"><span class="cl">## [10] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">## [11] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">## [12] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">## [13] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">## [14] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">## [15] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">## [16] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">## [17] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">## [18] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">## [19] &#34;Statistics Canada&#34;                              
</span></span><span class="line"><span class="cl">## [20] &#34;Statistics Canada&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can easily convert this to a dataframe now.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">labour</span> <span class="o">&lt;-</span> <span class="nf">as.data.frame</span><span class="p">(</span><span class="n">labour</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">labour</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> name </th>
   <th style="text-align:left;"> description </th>
   <th style="text-align:right;"> file_count </th>
   <th style="text-align:left;"> producers </th>
   <th style="text-align:left;"> pub_date </th>
   <th style="text-align:left;"> handle </th>
   <th style="text-align:left;"> global_id </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Labour Force Survey, 2021 </td>
   <td style="text-align:left;"> LFS data are used to produce the well-known ... </td>
   <td style="text-align:right;"> 91 </td>
   <td style="text-align:left;"> Statistics Canada </td>
   <td style="text-align:left;"> 2023-03-16T22:00:56Z </td>
   <td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/HP9TEK </td>
   <td style="text-align:left;"> hdl:11272.1/AB2/HP9TEK </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Labour Force Survey, 2022 </td>
   <td style="text-align:left;"> LFS data are used to produce the well-known ... </td>
   <td style="text-align:right;"> 57 </td>
   <td style="text-align:left;"> Statistics Canada </td>
   <td style="text-align:left;"> 2023-03-16T22:01:02Z </td>
   <td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/SRAU7E </td>
   <td style="text-align:left;"> hdl:11272.1/AB2/SRAU7E </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Labour Force Survey, 2023 </td>
   <td style="text-align:left;"> LFS data are used to produce the well-known ... </td>
   <td style="text-align:right;"> 31 </td>
   <td style="text-align:left;"> Statistics Canada </td>
   <td style="text-align:left;"> 2024-01-05T17:38:25Z </td>
   <td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/IJU1QK </td>
   <td style="text-align:left;"> hdl:11272.1/AB2/IJU1QK </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Labour Force Survey, 2006 </td>
   <td style="text-align:left;"> The Labour Force Survey provides estimates o... </td>
   <td style="text-align:right;"> 26 </td>
   <td style="text-align:left;"> Statistics Canada </td>
   <td style="text-align:left;"> 2023-03-16T21:47:04Z </td>
   <td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/0B5LPL </td>
   <td style="text-align:left;"> hdl:11272.1/AB2/0B5LPL </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Labour Force Survey, 2008 </td>
   <td style="text-align:left;"> The Labour Force Survey provides estimates o... </td>
   <td style="text-align:right;"> 26 </td>
   <td style="text-align:left;"> Statistics Canada </td>
   <td style="text-align:left;"> 2023-03-16T21:47:20Z </td>
   <td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/LA3WXI </td>
   <td style="text-align:left;"> hdl:11272.1/AB2/LA3WXI </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Labour Force Survey, 2011 </td>
   <td style="text-align:left;"> The Labour Force Survey provides estimates o... </td>
   <td style="text-align:right;"> 26 </td>
   <td style="text-align:left;"> Statistics Canada </td>
   <td style="text-align:left;"> 2023-03-16T21:47:47Z </td>
   <td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/GK3SFF </td>
   <td style="text-align:left;"> hdl:11272.1/AB2/GK3SFF </td>
  </tr>
</tbody>
</table>
<h2 id="explore">Explore
</h2><p>We have several datasets with labour in the title. One way of handling exploring this is to strip the dates so that we can look for unique values. First we extract the date:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">labour</span><span class="o">$</span><span class="n">year</span> <span class="o">&lt;-</span> <span class="nf">gsub</span><span class="p">(</span><span class="s">&#34;.*?([0-9]+).*$&#34;</span><span class="p">,</span> <span class="s">&#34;\\1&#34;</span><span class="p">,</span> <span class="n">labour</span><span class="o">$</span><span class="n">name</span><span class="p">)</span> <span class="c1"># regex to find ending numbers and storing in a new var</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">labour</span><span class="o">$</span><span class="n">year</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] &#34;2021&#34; &#34;2022&#34; &#34;2023&#34; &#34;2006&#34; &#34;2008&#34; &#34;2011&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then we strip the name:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">labour</span><span class="o">$</span><span class="n">name_no_year</span> <span class="o">&lt;-</span> <span class="nf">trimws</span><span class="p">(</span><span class="nf">gsub</span><span class="p">(</span><span class="s">&#34;[[:punct:]]|[[:digit:]]&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="n">labour</span><span class="o">$</span><span class="n">name</span><span class="p">))</span> <span class="c1"># regex to remove punctuation and remaing numbers</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">labour</span><span class="o">$</span><span class="n">name_no_year</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] &#34;Labour Force Survey&#34; &#34;Labour Force Survey&#34; &#34;Labour Force Survey&#34;
</span></span><span class="line"><span class="cl">## [4] &#34;Labour Force Survey&#34; &#34;Labour Force Survey&#34; &#34;Labour Force Survey&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>And then look at the unique values:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">labour</span><span class="o">$</span><span class="n">name_no_year</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##  [1] &#34;Labour Force Survey&#34;                                                                                                             
</span></span><span class="line"><span class="cl">##  [2] &#34;Survey of Labour and Income Dynamics&#34;                                                                                            
</span></span><span class="line"><span class="cl">##  [3] &#34;Survey of Persons Not in the Labour Force&#34;                                                                                       
</span></span><span class="line"><span class="cl">##  [4] &#34;Labour Force Income Profiles&#34;                                                                                                    
</span></span><span class="line"><span class="cl">##  [5] &#34;Cultural Labour Force Survey&#34;                                                                                                    
</span></span><span class="line"><span class="cl">##  [6] &#34;Small Area Business and Labour Database&#34;                                                                                         
</span></span><span class="line"><span class="cl">##  [7] &#34;Survey of Labour and Income Dynamics Reweighted&#34;                                                                                 
</span></span><span class="line"><span class="cl">##  [8] &#34;Labour Force Historical Review&#34;                                                                                                  
</span></span><span class="line"><span class="cl">##  [9] &#34;Labour Force Survey Rebased Revised&#34;                                                                                             
</span></span><span class="line"><span class="cl">## [10] &#34;Labour Force Survey  revision&#34;                                                                                                   
</span></span><span class="line"><span class="cl">## [11] &#34;Interwar Labour Database&#34;                                                                                                        
</span></span><span class="line"><span class="cl">## [12] &#34;Labour force historical review&#34;                                                                                                  
</span></span><span class="line"><span class="cl">## [13] &#34;Labour Income Profile for selected BC communities&#34;                                                                               
</span></span><span class="line"><span class="cl">## [14] &#34;Labour Market Activity Survey&#34;                                                                                                   
</span></span><span class="line"><span class="cl">## [15] &#34;Experienced Labour Force Population by Occupation custom tabulation&#34;                                                             
</span></span><span class="line"><span class="cl">## [16] &#34;Experienced Labour Force Population by Industry and Occupation custom tabulation&#34;                                                
</span></span><span class="line"><span class="cl">## [17] &#34;Labour Market Activity Survey Crosssectional Files&#34;                                                                              
</span></span><span class="line"><span class="cl">## [18] &#34;Labour Market Activity Survey Longitudinal Files&#34;                                                                                
</span></span><span class="line"><span class="cl">## [19] &#34;New Survey of London Life and Labour&#34;                                                                                            
</span></span><span class="line"><span class="cl">## [20] &#34;Labour Force  years of age and older in private households by occupation for Quebec  Census of Canada   Sample Custom tabulation&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>We only need the Labour Force Surveys themselves. These are occasionally revised, <a class="link" href="https://www150.statcan.gc.ca/n1/pub/71f0031x/71f0031x2023001-eng.htm"  target="_blank" rel="noopener"
    >documentation on these revisions here</a>, hence multiple records with slightly modified names (Labour Force Survey, Labour Force Survey (Rebased, Revised), etc)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">lfs</span> <span class="o">&lt;-</span> <span class="n">labour</span><span class="nf">[grepl</span><span class="p">(</span><span class="s">&#34;^Labour Force Survey&#34;</span><span class="p">,</span> <span class="n">labour</span><span class="o">$</span><span class="n">name_no_year</span><span class="p">),</span><span class="n">]</span> <span class="c1"># regex to find names starting with LFS</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">lfs</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> name </th>
   <th style="text-align:left;"> description </th>
   <th style="text-align:right;"> file_count </th>
   <th style="text-align:left;"> producers </th>
   <th style="text-align:left;"> pub_date </th>
   <th style="text-align:left;"> handle </th>
   <th style="text-align:left;"> global_id </th>
   <th style="text-align:left;"> year </th>
   <th style="text-align:left;"> name_no_year </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Labour Force Survey, 2021 </td>
   <td style="text-align:left;"> LFS data are used to produce the well-known ... </td>
   <td style="text-align:right;"> 91 </td>
   <td style="text-align:left;"> Statistics Canada </td>
   <td style="text-align:left;"> 2023-03-16T22:00:56Z </td>
   <td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/HP9TEK </td>
   <td style="text-align:left;"> hdl:11272.1/AB2/HP9TEK </td>
   <td style="text-align:left;"> 2021 </td>
   <td style="text-align:left;"> Labour Force Survey </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Labour Force Survey, 2022 </td>
   <td style="text-align:left;"> LFS data are used to produce the well-known ... </td>
   <td style="text-align:right;"> 57 </td>
   <td style="text-align:left;"> Statistics Canada </td>
   <td style="text-align:left;"> 2023-03-16T22:01:02Z </td>
   <td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/SRAU7E </td>
   <td style="text-align:left;"> hdl:11272.1/AB2/SRAU7E </td>
   <td style="text-align:left;"> 2022 </td>
   <td style="text-align:left;"> Labour Force Survey </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Labour Force Survey, 2023 </td>
   <td style="text-align:left;"> LFS data are used to produce the well-known ... </td>
   <td style="text-align:right;"> 31 </td>
   <td style="text-align:left;"> Statistics Canada </td>
   <td style="text-align:left;"> 2024-01-05T17:38:25Z </td>
   <td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/IJU1QK </td>
   <td style="text-align:left;"> hdl:11272.1/AB2/IJU1QK </td>
   <td style="text-align:left;"> 2023 </td>
   <td style="text-align:left;"> Labour Force Survey </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Labour Force Survey, 2006 </td>
   <td style="text-align:left;"> The Labour Force Survey provides estimates o... </td>
   <td style="text-align:right;"> 26 </td>
   <td style="text-align:left;"> Statistics Canada </td>
   <td style="text-align:left;"> 2023-03-16T21:47:04Z </td>
   <td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/0B5LPL </td>
   <td style="text-align:left;"> hdl:11272.1/AB2/0B5LPL </td>
   <td style="text-align:left;"> 2006 </td>
   <td style="text-align:left;"> Labour Force Survey </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Labour Force Survey, 2008 </td>
   <td style="text-align:left;"> The Labour Force Survey provides estimates o... </td>
   <td style="text-align:right;"> 26 </td>
   <td style="text-align:left;"> Statistics Canada </td>
   <td style="text-align:left;"> 2023-03-16T21:47:20Z </td>
   <td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/LA3WXI </td>
   <td style="text-align:left;"> hdl:11272.1/AB2/LA3WXI </td>
   <td style="text-align:left;"> 2008 </td>
   <td style="text-align:left;"> Labour Force Survey </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Labour Force Survey, 2011 </td>
   <td style="text-align:left;"> The Labour Force Survey provides estimates o... </td>
   <td style="text-align:right;"> 26 </td>
   <td style="text-align:left;"> Statistics Canada </td>
   <td style="text-align:left;"> 2023-03-16T21:47:47Z </td>
   <td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/GK3SFF </td>
   <td style="text-align:left;"> hdl:11272.1/AB2/GK3SFF </td>
   <td style="text-align:left;"> 2011 </td>
   <td style="text-align:left;"> Labour Force Survey </td>
  </tr>
</tbody>
</table>
<h2 id="looking-at-files">Looking at Files
</h2><p>We now know the data sets we&rsquo;re interested in. A dataset is made up of multiple files, however, and we likely don&rsquo;t want all the files for every dataset. We&rsquo;ll start by getting the file list for one of our datasets. Once we can do this for one dataset, we can iterate over all the datasets, although we won&rsquo;t implement that in this workshop.</p>
<p>Up until now, we&rsquo;ve been using the <code>search</code> api. We&rsquo;ll now use the <code>datasets</code> api.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">datasets_api</span> <span class="o">&lt;-</span> <span class="s">&#34;datasets/&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Like before, we&rsquo;ll build our query. We&rsquo;ll start with the 2011 LFS dataset. This is a multi-step process, as the first thing we need to do is get the <code>id</code> for the dataset, which is different from the <code>global_id</code> we retrieved from the <code>search</code> api, but we need the <code>global_id</code>, piped into the <code>datasets</code> api, to get the <code>id</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">id</span> <span class="o">&lt;-</span> <span class="n">lfs[lfs</span><span class="o">$</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#34;Labour Force Survey, 2011&#34;</span><span class="p">,</span> <span class="s">&#34;global_id&#34;</span><span class="p">,</span> <span class="n">drop</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="n">]</span> <span class="c1"># we want a simple vector returned</span>
</span></span><span class="line"><span class="cl"><span class="n">query</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;:persistentId/?persistentId=&#34;</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="c1"># limit to the id of interest, see dataverse API documentation</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="n">dataset_api_call</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">datasets_api</span><span class="p">,</span> <span class="n">query</span><span class="p">))</span> <span class="c1"># build the call</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] &#34;https://abacus.library.ubc.ca/api/datasets/:persistentId/?persistentId=hdl:11272.1/AB2/GK3SFF&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now we make the call and process the <code>body</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dataset_id_resp</span> <span class="o">&lt;-</span> <span class="n">dataset_api_call</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">httr2</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">httr2</span><span class="o">::</span><span class="nf">req_perform</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">dataset_id_body</span> <span class="o">&lt;-</span> <span class="n">jsonlite</span><span class="o">::</span><span class="nf">fromJSON</span><span class="p">(</span><span class="nf">rawToChar</span><span class="p">(</span><span class="n">dataset_id_resp</span><span class="o">$</span><span class="n">body</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We need the <code>id</code> and the <code>versionNumber</code> to access a file list.</p>
<p>Building the call:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dataset_id</span> <span class="o">&lt;-</span> <span class="n">dataset_id_body</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">id</span>
</span></span><span class="line"><span class="cl"><span class="n">dataset_ver</span> <span class="o">&lt;-</span> <span class="n">dataset_id_body</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">latestVersion</span><span class="o">$</span><span class="nf">versionNumber
</span></span></span><span class="line"><span class="cl"><span class="nf"></span><span class="p">(</span><span class="n">file_list_query</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">datasets_api</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">,</span> <span class="s">&#34;/versions/&#34;</span><span class="p">,</span> <span class="n">dataset_ver</span><span class="p">,</span> <span class="s">&#34;/files/&#34;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] &#34;https://abacus.library.ubc.ca/api/datasets/45508/versions/2/files/&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then execute, this time using the <code>httr2</code> option, <code>resp_body_json()</code> to convert the body to an <code>R</code> object, as it&rsquo;s a bit more streamlined.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dataset_file_resp</span> <span class="o">&lt;-</span> <span class="n">file_list_query</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">httr2</span><span class="o">::</span><span class="nf">request</span><span class="p">()</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">httr2</span><span class="o">::</span><span class="nf">req_perform</span><span class="p">()</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">httr2</span><span class="o">::</span><span class="nf">resp_body_json</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Files are generally indicated as being either data, documentation, or command files. We&rsquo;ll isolate just the data files in the list. All relevant data files have a <code>directoryLabel</code> equal to <code>Data</code>. We can use this to access only the data files.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">data_files</span> <span class="o">&lt;-</span> <span class="nf">Filter</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">directoryLabel</span> <span class="o">==</span> <span class="s">&#34;Data&#34;</span><span class="p">,</span> <span class="n">dataset_file_resp</span><span class="o">$</span><span class="n">data</span><span class="p">)</span> <span class="c1"># filter by directoryLabel</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We&rsquo;ll list out the files</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="kr">for</span><span class="p">(</span><span class="n">i</span> <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">data_files</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">  <span class="nf">print</span><span class="p">(</span><span class="n">data_files[[i]]</span><span class="o">$</span><span class="n">label</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] &#34;LFS_April_2011.tab&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;LFS_August_2011.tab&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;LFS_December_2011.tab&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;LFS_February_2011.tab&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;LFS_January_2011.tab&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;LFS_July_2011.tab&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;LFS_June_2011.tab&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;LFS_March_2011.tab&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;LFS_May_2011.tab&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;LFS_November_2011.tab&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;LFS_October_2011.tab&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;LFS_September_2011.tab&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;pub0111.prn&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;pub0211.prn&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;pub0311.prn&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;pub0411.prn&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;pub0511.prn&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;pub0611.prn&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;pub0711.prn&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;pub0811.prn&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;pub0911.prn&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;pub1011.prn&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;pub1111.prn&#34;
</span></span><span class="line"><span class="cl">## [1] &#34;pub1211.prn&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>From which we&rsquo;ll see that there are two different formats available to us. Let&rsquo;s grab just the <code>.tab</code> files.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">relevant_data_files</span> <span class="o">&lt;-</span> <span class="nf">Filter</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">grepl</span><span class="p">(</span><span class="s">&#34;tab$&#34;</span><span class="p">,</span> <span class="n">x</span><span class="o">$</span><span class="n">label</span><span class="p">),</span> <span class="n">data_files</span><span class="p">)</span> <span class="c1"># filter to files ending in tab</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>And then download them.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">dir.create</span><span class="p">(</span><span class="s">&#34;LFS_2011&#34;</span><span class="p">)</span> <span class="c1"># create a directory</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Warning in dir.create(&#34;LFS_2011&#34;): &#39;LFS_2011&#39; already exists
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dest_dir</span> <span class="o">&lt;-</span> <span class="s">&#34;LFS_2011/&#34;</span> <span class="c1"># store it in a variable</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># loop through the files and download them</span>
</span></span><span class="line"><span class="cl"><span class="kr">for</span><span class="p">(</span><span class="n">i</span> <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">relevant_data_files</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">  <span class="n">file_name</span> <span class="o">&lt;-</span> <span class="n">relevant_data_files[[i]]</span><span class="o">$</span><span class="n">label</span>
</span></span><span class="line"><span class="cl">  <span class="n">file_id</span> <span class="o">&lt;-</span> <span class="n">relevant_data_files[[i]]</span><span class="o">$</span><span class="n">dataFile</span><span class="o">$</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">  <span class="n">url_root</span> <span class="o">&lt;-</span> <span class="s">&#34;https://abacus.library.ubc.ca/api/access/datafile/&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">download.file</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="n">url_root</span><span class="p">,</span> <span class="n">file_id</span><span class="p">),</span> <span class="n">destfile</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>And build an annual set</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">lfs_2011_list</span> <span class="o">&lt;-</span> <span class="nf">lapply</span><span class="p">(</span><span class="nf">list.files</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">),</span> <span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">read.delim</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="n">x</span><span class="p">)))</span> <span class="c1"># read in each tab file into a list</span>
</span></span><span class="line"><span class="cl"><span class="n">lfs_2011_df</span> <span class="o">&lt;-</span> <span class="nf">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span> <span class="n">lfs_2011_list</span><span class="p">)</span> <span class="c1"># bind the list items into a df</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">lfs_2011_df[</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">11</span><span class="p">)</span><span class="n">]</span><span class="p">)</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">kbl</span><span class="p">()</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span> <span class="o">=</span> <span class="s">&#34;striped&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table class="table table-striped" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;">    REC_NUM </th>
   <th style="text-align:left;">    SURVYEAR </th>
   <th style="text-align:left;">    SURVMNTH </th>
   <th style="text-align:left;">    LFSSTAT </th>
   <th style="text-align:left;">      PROV </th>
   <th style="text-align:left;">      CMA </th>
   <th style="text-align:left;">     AGE_12 </th>
   <th style="text-align:left;">     AGE_6 </th>
   <th style="text-align:left;">      SEX </th>
   <th style="text-align:left;">    MARSTAT </th>
   <th style="text-align:left;">      EDUC </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> Min.   :     1 </td>
   <td style="text-align:left;"> Min.   :2011 </td>
   <td style="text-align:left;"> Min.   : 1.000 </td>
   <td style="text-align:left;"> Min.   :1.00 </td>
   <td style="text-align:left;"> Min.   :10.0 </td>
   <td style="text-align:left;"> Min.   :0.000 </td>
   <td style="text-align:left;"> Min.   : 1.000 </td>
   <td style="text-align:left;"> Min.   :1.0 </td>
   <td style="text-align:left;"> Min.   :1.000 </td>
   <td style="text-align:left;"> Min.   :1.000 </td>
   <td style="text-align:left;"> Min.   :0.000 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> 1st Qu.: 26294 </td>
   <td style="text-align:left;"> 1st Qu.:2011 </td>
   <td style="text-align:left;"> 1st Qu.: 4.000 </td>
   <td style="text-align:left;"> 1st Qu.:1.00 </td>
   <td style="text-align:left;"> 1st Qu.:24.0 </td>
   <td style="text-align:left;"> 1st Qu.:0.000 </td>
   <td style="text-align:left;"> 1st Qu.: 4.000 </td>
   <td style="text-align:left;"> 1st Qu.:2.0 </td>
   <td style="text-align:left;"> 1st Qu.:1.000 </td>
   <td style="text-align:left;"> 1st Qu.:1.000 </td>
   <td style="text-align:left;"> 1st Qu.:2.000 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> Median : 52587 </td>
   <td style="text-align:left;"> Median :2011 </td>
   <td style="text-align:left;"> Median : 7.000 </td>
   <td style="text-align:left;"> Median :1.00 </td>
   <td style="text-align:left;"> Median :35.0 </td>
   <td style="text-align:left;"> Median :0.000 </td>
   <td style="text-align:left;"> Median : 7.000 </td>
   <td style="text-align:left;"> Median :4.0 </td>
   <td style="text-align:left;"> Median :2.000 </td>
   <td style="text-align:left;"> Median :2.000 </td>
   <td style="text-align:left;"> Median :3.000 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> Mean   : 52589 </td>
   <td style="text-align:left;"> Mean   :2011 </td>
   <td style="text-align:left;"> Mean   : 6.509 </td>
   <td style="text-align:left;"> Mean   :2.19 </td>
   <td style="text-align:left;"> Mean   :35.1 </td>
   <td style="text-align:left;"> Mean   :1.473 </td>
   <td style="text-align:left;"> Mean   : 6.765 </td>
   <td style="text-align:left;"> Mean   :3.5 </td>
   <td style="text-align:left;"> Mean   :1.516 </td>
   <td style="text-align:left;"> Mean   :2.834 </td>
   <td style="text-align:left;"> Mean   :3.008 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> 3rd Qu.: 78880 </td>
   <td style="text-align:left;"> 3rd Qu.:2011 </td>
   <td style="text-align:left;"> 3rd Qu.: 9.000 </td>
   <td style="text-align:left;"> 3rd Qu.:4.00 </td>
   <td style="text-align:left;"> 3rd Qu.:47.0 </td>
   <td style="text-align:left;"> 3rd Qu.:2.000 </td>
   <td style="text-align:left;"> 3rd Qu.:10.000 </td>
   <td style="text-align:left;"> 3rd Qu.:5.0 </td>
   <td style="text-align:left;"> 3rd Qu.:2.000 </td>
   <td style="text-align:left;"> 3rd Qu.:6.000 </td>
   <td style="text-align:left;"> 3rd Qu.:4.000 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> Max.   :106352 </td>
   <td style="text-align:left;"> Max.   :2011 </td>
   <td style="text-align:left;"> Max.   :12.000 </td>
   <td style="text-align:left;"> Max.   :4.00 </td>
   <td style="text-align:left;"> Max.   :59.0 </td>
   <td style="text-align:left;"> Max.   :9.000 </td>
   <td style="text-align:left;"> Max.   :12.000 </td>
   <td style="text-align:left;"> Max.   :6.0 </td>
   <td style="text-align:left;"> Max.   :2.000 </td>
   <td style="text-align:left;"> Max.   :6.000 </td>
   <td style="text-align:left;"> Max.   :6.000 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> NA's   :975211 </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> NA </td>
  </tr>
</tbody>
</table>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/csc-data-blog/tags/r/">R</a>
        
            <a href="/csc-data-blog/tags/rstudio/">Rstudio</a>
        
    </section>


    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/csc-data-blog/p/transforming-data/">
        
        

        <div class="article-details">
            <h2 class="article-title">Transforming data</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/csc-data-blog/p/changing-the-rstudio-theme/">
        
        

        <div class="article-details">
            <h2 class="article-title">Changing the RStudio Theme</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/csc-data-blog/p/meta-analysis-on-randomized-clinical-trials-part-1/">
        
        

        <div class="article-details">
            <h2 class="article-title">Meta-Analysis on Randomized Clinical Trials - Part 1</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/csc-data-blog/p/getting-started-with-github/">
        
        

        <div class="article-details">
            <h2 class="article-title">Getting started with GitHub</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/csc-data-blog/p/sample-data-generation/">
        
        

        <div class="article-details">
            <h2 class="article-title">Sample Data Generation</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2025 Center for Scholarly Communication, UBC Okanagan
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/csc-data-blog/ts/main.56a136e062479dd895f2c63c1369f3212e7b695b942fa996e5cb0dd9c3c69473.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
